<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CODE</title>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <style>

      header {
        background-image: linear-gradient(to bottom right, #19181A, #B19F9E);
        text-align: center;
        padding: 20px;
        font-size: 20px;
        color: #F3E3E0;
      font-family:verdana
      }

      .button {
        background-color: #4CAF50; /* Green */
        border: none;
        color: white;
        padding: 16px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        -webkit-transition-duration: 0.4s; /* Safari */
        transition-duration: 0.4s;
        cursor: pointer;
      font-family:verdana
      }

      table {
        border-collapse: collapse;
        width: 100%;
      }

      th, td {
        text-align: left;
        padding: 8px;
        border-bottom: 1px solid black;

      }

      tr:hover {background-color: #f5f5f5;}


      .res_table{
        border: 1px solid black;
      }

      .res_tr_true{
        border: 1 px solid;
        background-color: rgb(85, 190, 85);
        margin: 1px;

      }

      .res_tr_false{
        border: 1px solid;
        background-color: rgb(247, 75, 75);
        margin: 1px;
      }

      .button1 {
        background-color: white; 
        color: black; 
        border: 2px solid #B19F9E;
        align
      }

      .button1:hover {
        background-color: #19181A;
        color: white;
      }

      .button2 {
        background-color: white; 
        color: black; 
        border: 2px solid #19181A;
      }

      .button2:hover {
        background-color: #B19F9E;
        color: black;
      }

      .buttons{
        text-align: center;
      }

      #dropdown{
      background-color: white;
      border: 2px solid black;
        color:#19181A ;
      font-size: 20px;
      }

      #dropdown:hover{
      background-color: #19181A;
        color: white;
      }

    </style>
  </head>
  
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <style>

      header {
        background-image: linear-gradient(to bottom right, #19181A, #B19F9E);
        text-align: center;
        padding: 20px;
        font-size: 20px;
        color: #F3E3E0;
      font-family:verdana
      }

      .button {
        background-color: #4CAF50; /* Green */
        border: none;
        color: white;
        padding: 16px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        -webkit-transition-duration: 0.4s; /* Safari */
        transition-duration: 0.4s;
        cursor: pointer;
      font-family:verdana
      }

      table {
        border-collapse: collapse;
        width: 100%;
      }

      th, td {
        text-align: left;
        padding: 8px;
        border-bottom: 1px solid black;

      }

      tr:hover {background-color: #f5f5f5;}


      .res_table{
        border: 1px solid black;
      }

      .res_tr_true{
        border: 1 px solid;
        background-color: rgb(85, 190, 85);
        margin: 1px;

      }

      .res_tr_false{
        border: 1px solid;
        background-color: rgb(247, 75, 75);
        margin: 1px;
      }

      .res_tr_tle{
        border: 1px solid;
        background-color: rgb(240, 201, 75);
        margin: 1px;
      }     

      .button1 {
        background-color: white; 
        color: black; 
        border: 2px solid #B19F9E;
        align
      }

      .button1:hover {
        background-color: #19181A;
        color: white;
      }

      .button2 {
        background-color: white; 
        color: black; 
        border: 2px solid #19181A;
      }

      .button2:hover {
        background-color: #B19F9E;
        color: black;
      }

      .buttons {
        text-align: ;
      }

      #dropdown{
      background-color: white;
      border: 2px solid black;
        color:#19181A ;
      font-size: 20px;
      }

      #dropdown:hover{
      background-color: #19181A;
        color: white;
      }

    </style>
  </head>
  <body bgcolor="#F7F9FB">
    <div style="text-align: center; color: red;">Time Left <span id="time">00:00</span> min</div><br/>
    <header>
      <h2 id='problem_title'><i></i></h2>
    </header>

    <table>
      <tr>

        <td style="height:400px;width:45%;">
          <p style="font-size:30px; color:#19181A; font-family:verdana" >Description</p>
          <p style="font-size:20px;color:#19181A; font-family:verdana" id = "problem_description"></p>
          <p style="font-size:30px; color:#19181A; font-family:verdana" >Sample Input</p>
          <p style="font-size:20px;color:#19181A; font-family:verdana" id = "sample_input"></p>
          <p style="font-size:30px; color:#19181A; font-family:verdana" >Sample Output</p>
          <p style="font-size:20px;color:#19181A; font-family:verdana" id = "sample_output"></p>
          <p style="font-size:30px; color:#19181A; font-family:verdana" >Max Time Limit</p>
          <p style="font-size:20px;color:#19181A; font-family:verdana" id = "max_time_limit"></p>
          </td>
          <td>
          
          <select id = "dropdown" style="position:absolute;right:39.2%;top:140px;">
            <option value="py">Python 3</option>
            <option value="c">C</option>
            <option value="cpp">C++</option>
            <option value="java">Java</option>
          </select>
          <br>
          <br>
          <br>
          <br>
          <div id="editor"style="width:45%;position:absolute;right:15px;top:170px;background-color: white;font-size: 20px;color:#B19F9E;"> </div>

        </td>
      </tr>

    </table>

    </br>
    </br>
    <div class = "buttons" id="center_align">
      <button class="button button1">Compile and run</button>
      <button class="button button2" onclick = "submit_code()">Submit</button>
      <br/>
      <br/>
      <br/>
      <br/>
      
    </div>
    <br/>
    <br/>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ace.js" type="text/javascript" charset="utf-8"></script>
    <script>
          var editor = ace.edit("editor");
          editor.setTheme("ace/theme/monokai");
          editor.getSession().setMode("ace/mode/javascript");
          document.getElementById("editor").style.height = "400px";

          var obj = document.getElementById("dropdown")
          var res_text = null

          obj.onchange = function(){
            if(obj.value === "c")
              editor.session.setMode("ace/mode/" + "c_cpp")
            else
              editor.session.setMode("ace/mode/" + obj.value)
          }
          var x=new XMLHttpRequest();

          function submit_code(){
            console.log(editor.getValue());
            var submit_button = document.getElementsByClassName("button button2");
            submit_button[0].disabled = true;
            var x=new XMLHttpRequest();
            x.onreadystatechange=function(){
            // if(document.getElementById("load") && document.getElementById('center_align')){
            //     var load = document.getElementById("load");
            //     //alert(load);
            //     document.getElementById('center_align').removeChild(load);
            // }
            var loading = document.createElement('img')
            loading.setAttribute('id',"load");
            loading.setAttribute('src','ajax-loader.gif')
            if(x.readyState == 1){
              document.getElementById('center_align').appendChild(loading);
              var tab = document.getElementById('res');
                
                if(tab){
                  document.getElementById('center_align').removeChild(tab);
                }
            }
            
            console.log(x.readyState,x.status);
            if(x.readyState==4 && x.status==200){
                var tab = document.getElementById('res');
                
                if(tab){
                  document.body.removeChild(tab);
                }
                var load = document.getElementById('load');
                document.getElementById('center_align').removeChild(load);
                console.log('rec');
                var res_text = JSON.parse(x.responseText);
                console.log(JSON.parse(x.responseText));
                

                var table = document.createElement('table');
                table.setAttribute('id',"res");
                table.setAttribute('class',"res_table");
                for (var i = 0; i < res_text.length; i++){
                  var tr = document.createElement('tr');   

                  var td1 = document.createElement('td');
                  var td2 = document.createElement('td');
            
                  if(res_text[i][0]==true){
                    var text1 = document.createTextNode('Test Case Passed');
                    var text2 = document.createTextNode(res_text[i][4]);
                    tr.setAttribute('class',"res_tr_true");
                  }
                  else{
                    var text1 = document.createTextNode('Test Case Failed');
                    if(res_text[i][3]=="")
                      var text2 = document.createTextNode("Wrong Output"); 
                    else if(res_text[i][3])
                      var text2 = document.createTextNode(res_text[i][3]); 
                    else
                      var text2 = document.createTextNode(res_text[3]); 
    
                    if(res_text[i][3]=="Time Limit Exceeded")
                      tr.setAttribute('class',"res_tr_tle");
                    else  
                      tr.setAttribute('class',"res_tr_false");

                  }
                  submit_button[0].disabled = false;
                  td1.appendChild(text1);
                  td2.appendChild(text2);
                  tr.appendChild(td1);
                  tr.appendChild(td2);
                  table.appendChild(tr);
                }
                document.getElementById('center_align').appendChild(table);
                }
              };

                var language = document.getElementById("dropdown");
                x.open("POST","http://localhost:5000/v1/run_code",true);
                x.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                x.send(JSON.stringify({'code': editor.getValue(),
                'language': language.value,
                'problem_id': sessionStorage.getItem('problem_id'),
                'student_id': sessionStorage.getItem('student_id'),
                'contest_id': sessionStorage.getItem('contest_id'),
                'time_out':  parseFloat(document.getElementById('max_time_limit').innerHTML)   } ));      
          }

          
          function startTimer(duration, display) {
              var timer = duration, minutes, seconds;
              setInterval(function () {
              minutes = parseInt(timer / 60, 10);
              seconds = parseInt(timer % 60, 10);

              minutes = minutes < 10 ? "0" + minutes : minutes;
              seconds = seconds < 10 ? "0" + seconds : seconds;
              if(minutes<5)
                display.style.color = "red";  
              display.textContent = minutes + ":" + seconds;
              
              if (--timer < 0) {
                alert("Time is up!\nTest Over");
                window.location.href = "sample.html";
              }
              }, 1000);
          }

          window.onload = function () {
            var x = new XMLHttpRequest
            x.open("POST","http://localhost:5001/getProblemDescription",true);
            x.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            x.onreadystatechange = function(){
              console.log(x.response);
              var res_text = JSON.parse(x.responseText);
              console.log(res_text);
              document.getElementById('problem_title').innerHTML = res_text['problem_title']
              document.getElementById('problem_description').innerHTML = res_text['problem_description']
              document.getElementById('sample_input').innerHTML = res_text['sample_input']
              document.getElementById('sample_output').innerHTML = res_text['sample_output']
              document.getElementById('max_time_limit').innerHTML = res_text['max_time_limit']
              sessionStorage.setItem("problem_id",res_text['problem_id']);
              
              var timelimit = parseFloat(res_text['time_limit']);  //TAKE IT FROM SESSION STORAGE
              var fiveMinutes = 60 * timelimit;
              display = document.querySelector('#time');
              startTimer(fiveMinutes, display);
            }
            // x.send(JSON.stringify({'contest_id': sessionStorage.setItem("contest_id") } ));
            x.send(JSON.stringify({'contest_id':sessionStorage.getItem('contest_id')}));  
            
            
            
          };
    </script>


  </body>

        
</html>

